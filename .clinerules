# Commander AI Development Rules

> **Note**: This is the main index. Detailed rules are in `.ai-rules/` directory to optimize token usage.

## Project Overview

**Commander** is a unified KV storage abstraction service written in Go, providing a REST API that supports multiple database backends (MongoDB, Redis, BBolt). Designed for edge devices and embedded systems.

- **Language**: Go 1.25.5
- **Framework**: Gin v1.11.0
- **Target**: Edge devices (ARM64, 512MB RAM)
- **Status**: Phase 1 Complete ✅

## Quick Reference

### Tech Stack
- Go 1.25.5 + Gin web framework
- Three database backends: BBolt (default), MongoDB, Redis
- Testing: testify, MockKV pattern
- Documentation: OpenAPI 3.0, Markdown

### Key Constraints
- Binary size: <20MB target
- Test coverage: 85%+ goal (currently 75.8%)
- Response time: <50ms p99 (edge devices)
- Memory: Optimize for 512MB RAM environments

### Project Structure
```
commander/
├── cmd/server/          # Application entry point
├── internal/
│   ├── config/          # Configuration management
│   ├── database/        # Database implementations (factory pattern)
│   ├── handlers/        # HTTP request handlers
│   └── kv/              # KV interface definition
├── docs/                # Documentation (2,968 lines)
└── .ai-rules/           # Detailed AI rules (modular)
```

## Rule Categories

For detailed rules, see `.ai-rules/` directory:

1. **[Code Style](.ai-rules/01-code-style.md)** - Go best practices, naming conventions
2. **[Git Workflow](.ai-rules/02-git-workflow.md)** - Atomic commits, commit message format
3. **[Testing](.ai-rules/03-testing.md)** - Test structure, coverage requirements
4. **[API Design](.ai-rules/04-api-design.md)** - REST API conventions, error handling
5. **[Database](.ai-rules/05-database.md)** - Backend patterns, data organization
6. **[Documentation](.ai-rules/06-documentation.md)** - Code comments, API docs
7. **[Performance](.ai-rules/07-performance.md)** - Edge device optimization
8. **[Security](.ai-rules/08-security.md)** - Input validation, error messages

## Universal Rules (Always Apply)

### 1. Atomic Commits
- **One logical change per commit**
- Clear, descriptive commit messages
- Follow conventional commits format

```
feat: add new feature
fix: resolve bug
docs: update documentation
test: add tests
refactor: restructure code
```

### 2. Test-Driven Development
- Write tests BEFORE or WITH implementation
- All new code must have tests
- Run tests before committing: `go test ./...`
- Target: 85%+ coverage

### 3. Documentation Required
- All exported functions need godoc comments
- Update API docs when changing endpoints
- Keep README.md current
- Document breaking changes

### 4. Error Handling
- Never ignore errors
- Use consistent error response format
- Provide helpful error messages
- Log errors appropriately

### 5. Code Review Checklist
Before committing, verify:
- [ ] Code compiles: `go build ./...`
- [ ] Tests pass: `go test ./...`
- [ ] Linting clean: `golangci-lint run`
- [ ] Documentation updated
- [ ] No secrets in code (.env files excluded)

## Current Phase: Phase 2

**Focus**: Documentation & Integration (Weeks 5-7)
- [ ] Generate Swagger UI
- [ ] Create edge device deployment guide
- [ ] Build data migration utilities
- [ ] Write troubleshooting playbook

**Next**: Phase 3 (Architecture Optimization)

## When Working on Commander

1. **Read the context** from `.ai-rules/` relevant to your task
2. **Follow the patterns** established in existing code
3. **Test thoroughly** - edge devices have unique constraints
4. **Document clearly** - users may have limited connectivity
5. **Optimize for size** - every MB matters on edge devices

## Quick Commands

```bash
# Build
go build -o bin/server ./cmd/server

# Test
go test ./...
go test -cover ./...

# Lint
golangci-lint run

# Run
go run cmd/server/main.go

# Test API
curl http://localhost:8080/health
```

## Important Files

- `docs/PROJECT_MANAGEMENT_PLAN.md` - 1-3 month roadmap
- `docs/PHASE1_COMPLETION.md` - Current status
- `docs/api-specification.yaml` - OpenAPI spec
- `docs/api-quickstart.md` - 5-minute tutorial
- `.env.example` - Configuration guide

## Need Help?

1. Check `.ai-rules/` for detailed guidance
2. Read `docs/` for project context
3. Review existing tests for patterns
4. See `docs/kv-usage.md` for library usage

---

**Last Updated**: 2026-02-03  
**Version**: 1.0.0  
**Maintainer**: Commander Team
