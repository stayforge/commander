version: '3.8'

services:
  commander:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: commander
    restart: unless-stopped
    ports:
      - "8080:8080"
    environment:
      # Server Configuration
      - SERVER_PORT=8080
      - ENVIRONMENT=PRODUCTION
      
      # Database Configuration (choose one)
      # Option 1: BBolt (default)
      - DATABASE=bbolt
      - DATA_PATH=/var/lib/stayforge/commander
      
      # Option 2: MongoDB
      # - DATABASE=mongodb
      # - MONGODB_URI=mongodb+srv://user:password@cluster.mongodb.net/
      
      # Option 3: Redis
      # - DATABASE=redis
      # - REDIS_URI=redis://:password@redis:6379/0
    volumes:
      # For BBolt: persist data
      - commander-data:/var/lib/stayforge/commander
    # Health check: Distroless doesn't have shell or common tools
    # Use external monitoring tools or remove healthcheck
    # The /health endpoint is available at http://localhost:8080/health
    # healthcheck:
    #   test: ["CMD", "true"]  # Placeholder - use external monitoring
    #   interval: 30s
    #   timeout: 10s
    #   retries: 3
    networks:
      - commander-network

volumes:
  commander-data:
    driver: local

networks:
  commander-network:
    driver: bridge

